# Example: Cross-Sheet Context Feature
#
# This example demonstrates how to use the cross_sheet configuration
# to pass context between sheets in a multi-phase workflow.

name: "cross-sheet-example"
description: "Demonstrates cross-sheet context passing"

workspace: "./cross-sheet-workspace"

backend:
  type: claude_cli
  timeout_seconds: 300

sheet:
  size: 1
  total_items: 3

# Cross-sheet context configuration
cross_sheet:
  # Automatically include stdout from previous sheets
  auto_capture_stdout: true

  # Maximum characters per previous sheet output
  max_output_chars: 2000

  # Number of previous sheets to include (0 = all)
  lookback_sheets: 2

  # File patterns to read between sheets (supports Jinja2)
  capture_files:
    - "{{ workspace }}/sheet-{{ sheet_num - 1 }}-result.md"

prompt:
  template: |
    {% if sheet_num == 1 %}
    # Sheet 1: Discovery

    Find 3 interesting facts about Mozart (the composer).
    Write them to {{ workspace }}/sheet-1-result.md

    {% elif sheet_num == 2 %}
    # Sheet 2: Analysis

    {% if previous_outputs %}
    ## Context from Sheet 1
    {{ previous_outputs[1][:500] if 1 in previous_outputs else "No output available" }}
    {% endif %}

    {% if previous_files %}
    ## Sheet 1 Results
    {% for path, content in previous_files.items() %}
    {{ content[:500] }}
    {% endfor %}
    {% endif %}

    Based on the facts discovered in Sheet 1, write a brief analysis
    of Mozart's most significant contribution to music.
    Write to {{ workspace }}/sheet-2-result.md

    {% elif sheet_num == 3 %}
    # Sheet 3: Synthesis

    {% if previous_outputs %}
    ## Previous Context
    {% for sheet_no, output in previous_outputs.items() %}
    ### From Sheet {{ sheet_no }}
    {{ output[:300] }}
    {% endfor %}
    {% endif %}

    Create a final summary combining the discovery and analysis.
    Write to {{ workspace }}/sheet-3-result.md
    {% endif %}

validations:
  - type: file_exists
    path: "{{ workspace }}/sheet-{{ sheet_num }}-result.md"
    description: "Sheet {{ sheet_num }} result file must exist"
