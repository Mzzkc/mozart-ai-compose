# Multi-Sheet Workflow Template
# For complex tasks that need to be broken down into phases

name: multi-sheet-workflow
workspace: ./workspace

backend:
  type: claude_cli
  model: sonnet  # More capable for complex multi-step workflows

sheet:
  total_sheets: 5
  timeout_seconds: 600  # 10 minutes per sheet

  dependencies:
    2: [1]    # Sheet 2 depends on sheet 1
    3: [2]    # Sheet 3 depends on sheet 2
    4: [3]    # Sheet 4 depends on sheet 3
    5: [1, 4] # Sheet 5 depends on sheets 1 and 4

  template: |
    You are working on a multi-phase project: {{ project_name }}

    CURRENT PHASE: Sheet {{ sheet_num }} of {{ total_sheets }}

    {% if sheet_num == 1 %}
    ## PHASE 1: PLANNING & ANALYSIS
    Your task: Analyze requirements and create a detailed plan

    Requirements: {{ requirements }}

    Please:
    1. Break down the requirements into specific tasks
    2. Create a project plan with milestones
    3. Identify potential risks and mitigations
    4. Document your analysis in planning.md

    {% elif sheet_num == 2 %}
    ## PHASE 2: FOUNDATION SETUP
    Your task: Set up the foundation based on the plan from Phase 1

    Previous work: Review {{ workspace }}/planning.md

    Please:
    1. Create necessary directory structure
    2. Set up configuration files
    3. Initialize core components
    4. Document setup in foundation.md

    {% elif sheet_num == 3 %}
    ## PHASE 3: CORE IMPLEMENTATION
    Your task: Implement the core functionality

    Previous work: Review {{ workspace }}/foundation.md

    Please:
    1. Implement main features
    2. Add error handling
    3. Write unit tests
    4. Document implementation in core.md

    {% elif sheet_num == 4 %}
    ## PHASE 4: INTEGRATION & TESTING
    Your task: Integrate components and run comprehensive testing

    Previous work: Review {{ workspace }}/core.md

    Please:
    1. Integrate all components
    2. Run integration tests
    3. Perform end-to-end testing
    4. Document test results in testing.md

    {% elif sheet_num == 5 %}
    ## PHASE 5: FINALIZATION & DELIVERY
    Your task: Finalize the project and prepare for delivery

    Previous work: Review all previous phase documents

    Please:
    1. Perform final quality check
    2. Create deployment documentation
    3. Generate project summary
    4. Document final deliverables in delivery.md
    {% endif %}

    Remember to check previous work and maintain continuity between phases.

validations:
  - name: phase_documentation
    type: file_exists
    path: "{{ workspace }}/{{ ['planning', 'foundation', 'core', 'testing', 'delivery'][sheet_num-1] }}.md"
    description: "Phase {{ sheet_num }} documented"

  - name: workspace_structure
    type: file_exists
    path: "{{ workspace }}"
    description: "Workspace exists"

notifications:
  - type: webhook
    url: "{{ notification_url | default('https://httpbin.org/post') }}"
    on: [sheet_completed]
    template: |
      Phase {{ sheet_num }} of {{ project_name }} completed âœ…
      Next: {% if sheet_num < total_sheets %}Phase {{ sheet_num + 1 }}{% else %}Project finished! ðŸŽ‰{% endif %}